# AI Roadmap: Level 2 - Visual Fingerprinting

## Objective
Implement a "Visual Search" capability to identify duplicate or highly similar 3D models and archives based on their visual content (thumbnails/previews), even if their filenames or file sizes drastically differ.

## Core Concept
Instead of relying solely on file hashes (MD5/SHA256) or filenames, we will generate **Perceptual Hashes (pHash)** or **Image Embeddings** for the preview images extracted from archives.

**Benefits:**
- Detect duplicates where one image is resized, re-saved, or slightly altered.
- Find "Remixes" where the model is rendered from a slightly different angle but remains visually identical.
- Group content by visual similarity (e.g., grouping all "Space Marine" miniatures together).

## Technical Implementation Plan

### 1. New Dependency Integration
- **Server-Side (Go):**
  - Integrate a library for perceptual hashing (e.g., `github.com/corona10/goimagehash`).
  - alternative: Integrate `onnxruntime-go` to run a lightweight CLIP or MobileNet model for generating vector embeddings.

### 2. Database / Storage Update
- Extend the `scan_results.json` or create a new `visual_index.json`.
- Store the `pHash` (uint64) or `EmbeddingVector` ([]float32) for each archive that has a preview image.

### 3. Processing Pipeline (Background Job)
- **Step 1: Extraction** (Existing): The system already extracts previews (JPG/PNG).
- **Step 2: Fingerprinting** (New):
  - For each extracted preview, generate a perceptual hash (pHash).
  - Store this hash in the index.
- **Step 3: Comparison** (New):
  - Implement a `FindVisualDuplicates` function.
  - Unlike exact hash matching, this uses **Hamming Distance**.
  - If `Distance(HashA, HashB) < Threshold` (e.g., < 5), treat them as visual duplicates.

### 4. UI Integration (Frontend)
- **New Tab: "Visual Matches"**
  - Display groups of visually similar items.
  - "Show Similar" button on any image to trigger a search against the index.
- **Visual Confidence Score**:
  - Show a percentage match (e.g., "95% Visual Match") next to the file.

## Phase 1 MVP (Perceptual Hashing)
We will start with **Difference Hash (dHash)** or **Average Hash** algorithms as they are extremely fast and effective for finding near-duplicates.

**Timeline:**
1. ** Backend:** Add `goimagehash` and update `Scanner` to compute hashes.
2. ** API:** Add endpoint `/api/visual-duplicates`.
3. ** UI:** Create the Visual Gallery view.

---
*Generated by Antigravity Agent*
